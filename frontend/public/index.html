<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI4Pi</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:sans-serif; }
  body { display:grid; grid-template-rows:1fr 1fr; gap:1em; height:100vh; padding:1em; }
  .top-half { display:grid; grid-template-columns:1fr 1fr; gap:1em; }
  .container { display:flex; flex-direction:column; padding:1em; border:1px solid #ccc; background:#f9f9f9; border-radius:8px; }
  h4 { margin-bottom:.5em; text-align:center; }
  button { margin:.3em 0; padding:.5em; border:none; background:#333; color:#fff; cursor:pointer; border-radius:4px; }
  button:hover { background:#555; }
  .box { flex:1; border:1px solid #ccc; overflow-y:auto; padding:.5em; font-size:small; background:#fff; border-radius:4px; }
  input { width:100%; padding:.3em; margin-top:.5em; }
  .bottom-half { height:50vh; display:flex; align-items:center; justify-content:center; }
  #image-container img { width:100%; height:100%; object-fit:cover; border-radius:8px; }
</style>
</head>
<body>

<div class="top-half">
  <div class="container">
    <h4>AI4Pi Chat</h4>
    <div id="status">Unregistered User</div>
    <button id="loginBtn">Login with Pi</button>
    <button id="payBtn">Pay 3.14 Pi</button>
    <div class="box" id="chatBox"></div>
    <input id="chatInput" placeholder="Type message...">
    <button id="sendChat">Send</button>
  </div>

  <div class="container">
    <h4>Gratitude Stream</h4>
    <div class="box" id="gratitudeBox"></div>
    <input id="gratitudeInput" placeholder="What are you thankful for?">
    <button id="submitGratitude">Submit</button>
  </div>
</div>

<!-- Bottom Half: AI Image (Loaded Dynamically) -->
<div class="bottom-half" id="image-container">
  <img id="aiImage" alt="AI and Nature">
</div>

<script>
const SANDBOX=true;
let user=null;
onload=()=>Pi.init({ version:"2.0", sandbox:SANDBOX });

// Load the binary image dynamically
async function loadImage() {
    try {
        let response = await fetch('data:image/png;base64,YOUR_BASE64_STRING_HERE');
        let blob = await response.blob();
        document.getElementById('aiImage').src = URL.createObjectURL(blob);
    } catch (error) {
        console.error("Error loading image:", error);
    }
}

// Run image loader
loadImage();

// Chat & Gratitude Functions
const addMessage = (boxId, sender, text) => {
  const box = document.getElementById(boxId);
  box.innerHTML += `<p><strong>${sender}:</strong> ${text}</p>`;
  box.scrollTop = box.scrollHeight;
};

document.getElementById("loginBtn").addEventListener("click", () => {
  alert("Initiating Pi login...");
  Pi.authenticate(["username"], a => {
    user = a.user ? a.user.username : null;
    alert(user ? `Welcome, ${user}` : "Login failed.");
    document.getElementById("status").innerText = user ? `Logged in as ${user}` : "Unregistered User";
  }, e => {
    alert(`Login error: ${e}`);
    document.getElementById("status").innerText = "Unregistered User";
  });
});

document.getElementById("payBtn").addEventListener("click", () => {
  alert("Initiating Pi payment...");
  Pi.createPayment({ amount:3.14, memo:"AI4Pi Payment