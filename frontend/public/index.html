<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI4Pi</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:sans-serif; }
  body { display:grid; grid-template-rows:1fr 1fr; gap:1em; height:100vh; padding:1em; }
  .top-half { display:grid; grid-template-columns:1fr 1fr; gap:1em; }
  .container { display:flex; flex-direction:column; padding:1em; border:1px solid #ccc; background:#f9f9f9; border-radius:8px; }
  h4 { margin-bottom:.5em; text-align:center; }
  button { margin:.3em 0; padding:.5em; border:none; background:#333; color:#fff; cursor:pointer; border-radius:4px; }
  button:hover { background:#555; }
  .box { flex:1; border:1px solid #ccc; overflow-y:auto; padding:.5em; font-size:small; background:#fff; border-radius:4px; }
  input { width:100%; padding:.3em; margin-top:.5em; }
  .bottom-half { display:grid; grid-template-columns:1fr; gap:1em; }
</style>
</head>
<body>

<div class="top-half">
  <div class="container">
    <h4>AI4Pi Chat</h4>
    <div id="status">Unregistered User</div>
    <button id="loginBtn">Login with Pi</button>
    <button id="payBtn">Pay 3.14 Pi</button>
    <div class="box" id="chatBox"></div>
    <input id="chatInput" placeholder="Type message...">
    <button id="sendChat">Send</button>
  </div>

  <div class="container">
    <h4>Gratitude Stream</h4>
    <div class="box" id="gratitudeBox"></div>
    <input id="gratitudeInput" placeholder="What are you thankful for?">
    <button id="submitGratitude">Submit</button>
    
    <h4>Complaints Stream</h4>
    <div class="box" id="complaintsBox"></div>
    <input id="complaintsInput" placeholder="Whatâ€™s your complaint?">
    <button id="submitComplaint">Submit</button>
  </div>
</div>

<!-- Community Chat Section -->
<div class="container">
  <h4>Community Chat (1 message/5s)</h4>
  <div class="box" id="communityBox"></div>
  <input id="communityInput" placeholder="Say something...">
  <button id="sendCommunity" disabled>Send</button>
</div>

<script>
const SANDBOX=true; let user=null, lastMsgTime=0;
onload=()=>Pi.init({ version:"2.0", sandbox:SANDBOX });

const addMessage = (boxId, sender, text) => {
  document.getElementById(boxId).innerHTML += `<p><strong>${sender}:</strong> ${text}</p>`;
};

document.getElementById("loginBtn").addEventListener("click", () => {
  alert("Initiating Pi login...");
  Pi.authenticate(["username"], a => {
    user=a.user?a.user.username:null; alert(user?`Welcome, ${user}`:"Login failed.");
    document.getElementById("status").innerText=user?`Logged in as ${user}`:"Unregistered User";
  }, e => alert(`Login error: ${e}`));
});

document.getElementById("payBtn").addEventListener("click", () => {
  alert("Initiating Pi payment...");
  Pi.createPayment({ amount:3.14, memo:"AI4Pi Payment", metadata:{ test:"data" } },
  { onSuccessfulPayment:(p,t)=>alert(`Payment success! TxID: ${t}`),
    onError:e=>alert(`Payment error: ${e}`),
    onPaymentCancel:p=>alert(`Payment cancelled: ${p}`) });
});

document.getElementById("sendChat").addEventListener("click", () => {
  const i=document.getElementById("chatInput"), msg=i.value.trim();
  if (msg) { i.value=""; addMessage("chatBox", "You", msg);
    setTimeout(() => addMessage("chatBox", "AI", `Echo: ${msg}`), 800); }
});

document.getElementById("submitGratitude").addEventListener("click", () => {
  const i=document.getElementById("gratitudeInput"), msg=i.value.trim();
  if (msg) { i.value=""; addMessage("gratitudeBox", "Grateful User", msg); }
});

document.getElementById("submitComplaint").addEventListener("click", () => {
  const i=document.getElementById("complaintsInput"), msg=i.value.trim();
  if (msg) { i.value=""; addMessage("complaintsBox", "Complaint", msg); }
});

document.getElementById("sendCommunity").addEventListener("click", () => {
  const now=Date.now(), i=document.getElementById("communityInput"), msg=i.value.trim();
  if (msg && now-lastMsgTime>=5000) { 
    i.value=""; lastMsgTime=now; addMessage("communityBox", "User", msg);
    document.getElementById("sendCommunity").disabled=true;
    setTimeout(() => document.getElementById("sendCommunity").disabled=false, 5000);
  }
});
</script>

</body>
</html>